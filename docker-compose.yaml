services:

  plural-app:
    build:
      context: ./plural_app
      args:
        POCKETBASE_URL: $POCKETBASE_URL
      dockerfile: Dockerfile
    ports:
      - 301:301
    volumes:
      - plural_web_build:/app/plural_repository/plural_app/build/web
  plural-pocketbase:
    build:
      context: ./plural_pocketbase
      dockerfile: Dockerfile
    ports:
      - 8080:8080
    volumes:
      - plural_pb_data:/pb/pb_data
      - ./plural_pocketbase/pb_migrations:/pb/pb_migrations

volumes:
  plural_pb_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      # PB_DATA_PATH=/path/to/data docker-compose -f docker-compose.yaml up -d --build
      device: $PB_DATA_PATH

  plural_web_build:
    driver: local
    driver_opts:
      type: none
      o: bind
      # PLURAL_WEB_BUILD_PATH=/path/to/build/path docker-compose -f docker-compose.yaml up -d --build
      device: $PLURAL_WEB_BUILD_PATH

